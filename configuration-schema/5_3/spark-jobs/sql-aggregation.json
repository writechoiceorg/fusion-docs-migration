{
  "additionalProperties": true,
  "category": "Other",
  "categoryPriority": 1,
  "description": "Use this job when you want to aggregate your data in some way.",
  "properties": {
    "aggregationTime": {
      "description": "Timestamp to use for the aggregation results. Defaults to NOW.",
      "format": "date-time",
      "hints": [
        "advanced"
      ],
      "title": "Aggregation Time",
      "type": "string"
    },
    "id": {
      "description": "The ID for this Spark job. Used in the API to reference this job. Allowed characters: a-z, A-Z, dash (-) and underscore (_). Maximum length: 63 characters.",
      "maxLength": 63,
      "pattern": "[a-zA-Z][_\\-a-zA-Z0-9]*[a-zA-Z0-9]?",
      "title": "Spark Job ID",
      "type": "string"
    },
    "inputCollection": {
      "description": "Collection containing signals to be aggregated.",
      "title": "Source Collection",
      "type": "string"
    },
    "optimizeSegments": {
      "default": 0,
      "description": "If set to a value above 0, the aggregator job will optimize the resulting Solr collection into this many segments",
      "exclusiveMinimum": false,
      "hints": [
        "advanced"
      ],
      "minimum": 0,
      "title": "Optimize Segments",
      "type": "integer"
    },
    "outputCollection": {
      "description": "The collection to write the aggregates to on output. This property is required if the selected output / rollup pipeline requires it (the default pipeline does). A special value of '-' disables the output.",
      "hints": [
        "advanced"
      ],
      "minLength": 1,
      "title": "Output Collection",
      "type": "string"
    },
    "parameters": {
      "description": "Other aggregation parameters (e.g. timestamp field etc..).",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Parameters",
      "type": "array"
    },
    "readOptions": {
      "description": "Additional configuration settings to fine-tune how input records are read for this aggregation.",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Read Options",
      "type": "array"
    },
    "referenceTime": {
      "description": "Timestamp to use for computing decays and to determine the value of NOW.",
      "format": "date-time",
      "hints": [
        "advanced"
      ],
      "title": "Reference Time",
      "type": "string"
    },
    "rollupSql": {
      "description": "Use SQL to perform a rollup of previously aggregated docs. If left blank, the aggregation framework will supply a default SQL query to rollup aggregated metrics.",
      "hints": [
        "lengthy",
        "code/sql",
        "advanced"
      ],
      "minLength": 1,
      "title": "Rollup SQL",
      "type": "string"
    },
    "rows": {
      "default": 10000,
      "description": "Number of rows to read from the source collection per request.",
      "hints": [
        "advanced"
      ],
      "title": "Batch Size",
      "type": "integer"
    },
    "selectQuery": {
      "default": "*:*",
      "description": "The query to select the desired input documents.",
      "hints": [
        "advanced"
      ],
      "minLength": 1,
      "title": "Query",
      "type": "string"
    },
    "signalTypes": {
      "description": "The signal types. If not set then any signal type is selected",
      "items": {
        "type": "string"
      },
      "title": "Signal Types",
      "type": "array"
    },
    "skipCheckEnabled": {
      "default": true,
      "description": "If the catch-up flag is enabled and this field is checked, the job framework will execute a fast Solr query to determine if this run can be skipped.",
      "hints": [
        "advanced"
      ],
      "title": "Job Skip Check Enabled?",
      "type": "boolean"
    },
    "skipJobIfSignalsEmpty": {
      "description": "Skip Job run if signals collection is empty",
      "hints": [
        "advanced"
      ],
      "title": "Skip Job run",
      "type": "boolean"
    },
    "sourceCatchup": {
      "default": true,
      "description": "If checked, only aggregate new signals created since the last time the job was successfully run. If there is a record of such previous run then this overrides the starting time of time range set in 'timeRange' property. If unchecked, then all matching signals are aggregated and any previously aggregated docs are deleted to avoid double counting.",
      "hints": [
        "advanced"
      ],
      "title": "Aggregate New and Merge with Existing",
      "type": "boolean"
    },
    "sourceRemove": {
      "default": false,
      "description": "If checked, remove signals from source collection once aggregation job has finished running.",
      "hints": [
        "advanced"
      ],
      "title": "Remove signals from source",
      "type": "boolean"
    },
    "sparkConfig": {
      "description": "Spark configuration settings.",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Spark Settings",
      "type": "array"
    },
    "sql": {
      "description": "Use SQL to perform the aggregation. You do not need to include a time range filter in the WHERE clause as it gets applied automatically before executing the SQL statement.",
      "hints": [
        "lengthy",
        "code/sql"
      ],
      "minLength": 1,
      "title": "SQL",
      "type": "string"
    },
    "timeRange": {
      "description": "The time range to select signals on, e.g., `[* TO NOW]`. See Solr date range for more options (https://solr.apache.org/guide/8_8/working-with-dates.html).",
      "hints": [
        "advanced"
      ],
      "minLength": 1,
      "title": "Time Range",
      "type": "string"
    },
    "type": {
      "default": "aggregation",
      "enum": [
        "aggregation"
      ],
      "hints": [
        "readonly"
      ],
      "title": "Spark Job Type",
      "type": "string"
    },
    "useNaturalKey": {
      "default": true,
      "description": "Use a natural key provided in the raw signals data for aggregation, rather than relying on Solr UUIDs. Migrated aggregations jobs from Fusion 4 will need this set to false.",
      "hints": [
        "advanced"
      ],
      "title": "Use Natural Key?",
      "type": "boolean"
    }
  },
  "required": [
    "id",
    "inputCollection",
    "sql",
    "type"
  ],
  "title": "SQL Aggregation",
  "type": "object"
}
