{
  "type": "object",
  "title": "Graph Security Trimming",
  "description": "Graph security trimming stage is an alternative to the general \"Security Trimming Stage\". Unlike the general filter, the Graph security trimming stage performs all of the security trimming within a single filter query. You should always prefer this filter over the general Security Trimming filter when you are not trimming legacy data sources. If you have the _lw_acl_ss acl field present on all of your trimmed content documents, you should be using this filter.",
  "required": [
    "userIdentitySource",
    "userIdentityKey"
  ],
  "properties": {
    "skip": {
      "type": "boolean",
      "title": "Skip This Stage",
      "description": "Set to true to skip this stage.",
      "default": false,
      "hints": [
        "advanced"
      ]
    },
    "label": {
      "type": "string",
      "title": "Label",
      "description": "A unique label for this stage.",
      "hints": [
        "advanced"
      ],
      "maxLength": 255
    },
    "condition": {
      "type": "string",
      "title": "Condition",
      "description": "Define a conditional script that must result in true or false. This can be used to determine if the stage should process or not.",
      "hints": [
        "code",
        "code/javascript",
        "advanced"
      ]
    },
    "legacy": {
      "type": "boolean",
      "title": "Legacy",
      "description": "True if this stage only supports legacy mode",
      "hints": [
        "readonly",
        "hidden"
      ]
    },
    "aclSolrCollection": {
      "type": "string",
      "title": "ACL solr collection",
      "description": "This is the Solr collection that contains the User and Group ACLs. It is typically the same as the content collection.",
      "hints": [
        "advanced",
        "hidden"
      ]
    },
    "userIdentitySource": {
      "type": "string",
      "title": "User ID source",
      "description": "Specify whether the value comes from an http header or query parameter. Must be either query_param or header.",
      "default": "query_param"
    },
    "userIdentityKey": {
      "type": "string",
      "title": "User ID key",
      "description": "The value of the header or query parameter that contains the User ID. E.g. username, userID, etc.",
      "default": "username"
    },
    "joinField": {
      "type": "string",
      "title": "Join Field",
      "description": "The field to use to match acls to content. Should be set to \"id\" if ACLs are in a separate collection than content collection. If your acls are stored in the content collection, use \"_lw_acl_ss\".",
      "default": "_lw_acl_ss",
      "hints": [
        "hidden"
      ]
    },
    "excludeDatasources": {
      "type": "string",
      "title": "Exclude Data Source ID(s)",
      "description": "Comma separated datasource IDs - security trimming will not be performed on documents from these data sources and therefore they will be public."
    },
    "includeDatasources": {
      "type": "string",
      "title": "Inclusive Data Source ID(s)",
      "description": "Comma separated datasource IDs - security trimming will be performed only on documents from these data sources. Other datasources will be public."
    },
    "joinMethod": {
      "type": "string",
      "title": "Join method",
      "description": "The Solr join query method parameter. Can be index or topLevelDV.",
      "default": "topLevelDV",
      "hints": [
        "advanced",
        "hidden"
      ]
    },
    "treatExternalContentAsPublic": {
      "type": "boolean",
      "title": "Treat external content as public",
      "description": "If a content document does not have a _lw_data_source_s field, treat it as public."
    }
  },
  "category": "Set Up",
  "categoryPriority": 8,
  "unsafe": false
}
