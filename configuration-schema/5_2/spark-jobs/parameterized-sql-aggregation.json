{
  "additionalProperties": true,
  "category": "Other",
  "categoryPriority": 1,
  "description": "A SQL aggregation job where users provide parameters to be injected into a built-in SQL template at runtime.",
  "properties": {
    "hiddenParameters": {
      "description": "Additional settings used to tune the underlying aggregation job.",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Hidden Parameters",
      "type": "array"
    },
    "id": {
      "description": "The ID for this Spark job. Used in the API to reference this job. Allowed characters: a-z, A-Z, dash (-) and underscore (_). Maximum length: 63 characters.",
      "maxLength": 63,
      "pattern": "[a-zA-Z][_\\-a-zA-Z0-9]*[a-zA-Z0-9]?",
      "title": "Spark Job ID",
      "type": "string"
    },
    "inputCollection": {
      "description": "Collection containing documents to be aggregated.",
      "title": "Source Collection",
      "type": "string"
    },
    "notes": {
      "description": "A short description about this job.",
      "hints": [
        "lengthy"
      ],
      "title": "Notes",
      "type": "string"
    },
    "optimizeSegments": {
      "default": 0,
      "description": "If set to a value above 0, the aggregator job will optimize the resulting Solr collection into this many segments",
      "exclusiveMinimum": false,
      "hints": [
        "advanced"
      ],
      "minimum": 0,
      "title": "Optimize Segments",
      "type": "integer"
    },
    "outputCollection": {
      "description": "The collection to write the aggregates to on output. Defaults to the input collection if not specified.",
      "title": "Output Collection",
      "type": "string"
    },
    "parameters": {
      "description": "Parameters bound on the SQL template at runtime.",
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "SQL Parameters",
      "type": "array"
    },
    "readOptions": {
      "description": "Additional configuration settings to fine-tune how input records are read for this aggregation.",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Read Options",
      "type": "array"
    },
    "referenceTime": {
      "description": "Timestamp to use for computing decays and to determine the value of NOW.",
      "format": "date-time",
      "hints": [
        "advanced"
      ],
      "title": "Reference Time",
      "type": "string"
    },
    "rollupSql": {
      "description": "Use SQL to perform a rollup of previously aggregated docs. If left blank, the aggregation framework will supply a default SQL query to rollup aggregated metrics.",
      "hints": [
        "advanced",
        "code/sql"
      ],
      "minLength": 1,
      "title": "Rollup SQL",
      "type": "string"
    },
    "selectQuery": {
      "default": "*:*",
      "description": "The query to select the desired signals. If not set then '*:*' will be used, or equivalent.",
      "hints": [
        "advanced"
      ],
      "title": "Query",
      "type": "string"
    },
    "skipCheckEnabled": {
      "default": true,
      "description": "If the catch-up flag is enabled and this field is checked, the job framework will execute a fast Solr query to determine if this run can be skipped.",
      "hints": [
        "advanced"
      ],
      "title": "Job Skip Check Enabled?",
      "type": "boolean"
    },
    "sourceCatchup": {
      "default": true,
      "description": "If checked, only aggregate new signals created since the last time the job was successfully run. If there is a record of such previous run then this overrides the starting time of time range set in 'timeRange' property. If unchecked, then all matching signals are aggregated and any previously aggregated docs are deleted to avoid double counting.",
      "hints": [
        "advanced"
      ],
      "title": "Aggregate New and Merge with Existing",
      "type": "boolean"
    },
    "sourceRemove": {
      "default": false,
      "description": "If true, the processed source signals will be removed after aggregation. Default is false.",
      "hints": [
        "advanced"
      ],
      "title": "Remove Source",
      "type": "boolean"
    },
    "sparkConfig": {
      "description": "Spark configuration settings.",
      "hints": [
        "advanced"
      ],
      "items": {
        "properties": {
          "key": {
            "title": "Parameter Name",
            "type": "string"
          },
          "value": {
            "title": "Parameter Value",
            "type": "string"
          }
        },
        "required": [
          "key"
        ],
        "type": "object"
      },
      "title": "Spark Settings",
      "type": "array"
    },
    "sql": {
      "description": "Use SQL to perform the aggregation. You do not need to include a time range filter in the WHERE clause as it gets applied automatically before executing the SQL statement.",
      "hints": [
        "advanced",
        "code/sql"
      ],
      "minLength": 1,
      "title": "SQL",
      "type": "string"
    },
    "timeRange": {
      "description": "The time range to select signals on, e.g., `[* TO NOW]`. See Solr date range for more options (https://solr.apache.org/guide/8_8/working-with-dates.html).",
      "hints": [
        "advanced"
      ],
      "minLength": 1,
      "title": "Time Range",
      "type": "string"
    },
    "type": {
      "default": "sql_template",
      "enum": [
        "sql_template"
      ],
      "hints": [
        "readonly"
      ],
      "title": "Spark Job Type",
      "type": "string"
    },
    "useNaturalKey": {
      "default": true,
      "description": "Use a natural key provided in the raw signals data for aggregation, rather than relying on Solr UUIDs. Migrated aggregations jobs from Fusion 4 will need this set to false.",
      "hints": [
        "advanced"
      ],
      "title": "Use Natural Key?",
      "type": "boolean"
    }
  },
  "required": [
    "id",
    "inputCollection",
    "type"
  ],
  "title": "Parameterized SQL Aggregation",
  "type": "object"
}
