---
title: "Machine Learning (Responses) Stage"
permalink: "267"
---

This is a [response rewriting](/fusion-ai/4.2/449/response-rewriting) stage that is similar to the [Machine Learning query stage](/fusion-ai/4.2/513/machine-learning-stage). It must be used *after* the [Solr Query stage](/fusion-server/4.2/265/solr-query-stage) in your pipeline. It uses a trained machine learning model to analyze a field or fields of a [Response](/fusion-pipeline-javadocs/4.2/?com/lucidworks/apollo/pipeline/query/Response.html) object and stores the results of analysis in a new field added to either the Response or the [Context](/fusion-pipeline-javadocs/4.2/?com/lucidworks/apollo/common/pipeline/Context.html) object.

In order to use the Machine Learning (Responses) Stage, you must train a machine learning model. There are two different ways to train a model:

* Use a Fusion job that trains a model, like [Logistic Regression](/fusion-ai/4.2/558/logistic-regression-classifier-training-jobs) or [Random Forest](/fusion-ai/4.2/579/random-forest-classifier-training-jobs).
* Train a model using [Spark’s MLlib API](https://spark.apache.org/docs/latest/mllib-guide.html) outside of Fusion, and upload this model into Fusion’s [blob store](/fusion-server/4.2/153/blob-storage). Complete details are available in [Machine Learning Models in Fusion](/fusion-ai/4.2/492/machine-learning-models-in-fusion).

## Configuration

<Tip>
When entering configuration values in the UI, use *unescaped* characters, such as `\t` for the tab character. When entering configuration values in the API, use *escaped* characters, such as `\\t` for the tab character.
</Tip>

import {SchemaParamFields} from "/snippets/SchemaParamFields.mdx";
import {schema} from "/snippets/configuration-schema/4_2/query-stages/machine-learning.mdx";

<SchemaParamFields schema={schema}/>
